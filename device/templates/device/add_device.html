{% extends 'customer/base.html' %}
{% block content %}
  <h2>Add Device to {{ location_name }}</h2>
  <form method="post" id="deviceForm">
    {% csrf_token %}
    <div class="form-group">
      <label for="device_type">Device Type:</label>
      {% for radio in form.device_type %}
        <div class="form-check">
          {{ radio }}
          <label for="{{ radio.id_for_label }}" class="form-check-label">{{ radio.choice_label }}</label>
        </div>
      {% endfor %}
    </div>
    {% if form.device_type.errors %}
      <div class="alert alert-danger">
        {{ form.device_type.errors }}
      </div>
    {% endif %}
    <div class="form-group">
      {{ form.device_model.label_tag }}
      {{ form.device_model }}
      {% if form.device_model.errors %}
        <div class="alert alert-danger">
          {{ form.device_model.errors }}
        </div>
      {% endif %}
    </div>
    <button type="submit" class="btn btn-primary">Add Device</button>
  </form>
{% endblock %}

{% block javascript %}
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Attach change event to device type radio buttons
    const deviceTypeRadios = document.querySelectorAll('input[name="device_type"]');
    deviceTypeRadios.forEach(function(radio) {
      radio.addEventListener('change', function() {
        // Fetch device models based on selected device type
        const deviceType = this.value;
        fetch(`/get_device_models/?device_type=${deviceType}`)
          .then(response => response.json())
          .then(data => {
            // Update the device model dropdown with new options
            const deviceModelSelect = document.querySelector('select[name="device_model"]');
            deviceModelSelect.innerHTML = data.models.map(model => 
              `<option value="${model.id}">${model.name}</option>`
            ).join('');
          })
          .catch(error => console.error('Error fetching device models:', error));
      });
    });
  });
</script>
{% endblock %}
